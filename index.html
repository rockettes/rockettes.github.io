<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Pro Coach IA</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#ff4b4b" />

  <!-- iOS -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Pro Coach IA" />
  <link rel="apple-touch-icon" href="icons/icon.svg" />

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { width: 100%; height: 100%; overflow: hidden; background: #1a1a2e; }

    /* Splash — visível até o iframe carregar */
    #splash {
      position: fixed;
      inset: 0;
      background: #1a1a2e;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 20px;
      z-index: 10;
      transition: opacity 0.5s ease;
    }
    #splash.hide { opacity: 0; pointer-events: none; }

    #splash h1 {
      color: white;
      font-size: 1.5rem;
      font-family: -apple-system, sans-serif;
      font-weight: 700;
    }
    #splash p {
      color: #aaa;
      font-size: 0.85rem;
      font-family: sans-serif;
    }
    .spinner {
      width: 36px; height: 36px;
      border: 4px solid rgba(255,75,75,0.3);
      border-top-color: #ff4b4b;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* Iframe ocupa tela toda */
    #app-frame {
      position: fixed;
      inset: 0;
      width: 100%;
      height: 100%;
      border: none;
      /* Começa invisível, aparece após carregar */
      opacity: 0;
      transition: opacity 0.5s ease;
    }
    #app-frame.visible { opacity: 1; }
  </style>
</head>
<body>

  <!-- Tela de splash -->
  <div id="splash">
    <svg width="90" height="90" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
      <rect width="512" height="512" rx="102" fill="#ff4b4b"/>
      <circle cx="256" cy="243" r="159" fill="none" stroke="white" stroke-width="8" opacity="0.3"/>
      <rect x="154" y="223" width="204" height="41" rx="20" fill="white"/>
      <rect x="123" y="194" width="46" height="97" rx="23" fill="white"/>
      <rect x="343" y="194" width="46" height="97" rx="23" fill="white"/>
      <circle cx="256" cy="123" r="13" fill="white"/>
      <circle cx="215" cy="148" r="9" fill="white" opacity="0.6"/>
      <circle cx="297" cy="148" r="9" fill="white" opacity="0.6"/>
      <polyline points="154,333 184,333 200,302 218,364 236,320 256,333 276,333 295,307 314,353 333,333 358,333"
                stroke="white" stroke-width="5" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
    <h1>Pro Coach IA</h1>
    <p>Carregando...</p>
    <div class="spinner"></div>
  </div>

  <!-- App Streamlit dentro do iframe -->
  <iframe
    id="app-frame"
    src="https://bodybuildingcoach.streamlit.app/?embedded=true"
    allow="camera; microphone; clipboard-write"
    loading="lazy"
  ></iframe>

  <script>
    // Registrar Service Worker
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("sw.js").catch(console.error);
    }

    // Quando o iframe carregar, esconde o splash e mostra o app
    const frame  = document.getElementById("app-frame");
    const splash = document.getElementById("splash");

    frame.addEventListener("load", () => {
      splash.classList.add("hide");
      frame.classList.add("visible");
    });

    // Fallback: se demorar mais de 8s, esconde o splash de qualquer forma
    setTimeout(() => {
      splash.classList.add("hide");
      frame.classList.add("visible");
    }, 8000);
  </script>

</body>
</html>